<?xml version="1.0"?>

<robot name="codfather" xmlns:xacro="http://www.ros.org/wiki/xacro">

	<xacro:arg name="windType" default="global" />
	<xacro:arg name="waterType" default="global" />
	<xacro:property name="windType" value="$(arg windType)" />
	<xacro:property name="waterType" value="$(arg waterType)" />
	<xacro:property name="windType" value="global" />

	<!-- Defining sail model -->
	<link name="body">
		<inertial>
			<origin rpy="0 0 0" xyz="-0.073357 0.000076 1.474309" />
			<mass value="8" />
			<inertia ixx="0.05528877352368592" ixy="0.0" iyy="1.516807268007787" ixz="0.014795587280986374" iyz="0.0" izz="1.5313432835820897" />
		</inertial>

		<collision name="collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/deck_hull_convex_hull.obj" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="0 0 1.4478" />
		</collision>

		<visual name="visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/deck_hull.dae" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="0 0 1.4478" />
		</visual>
	</link>

	<link name="keel">
		<inertial>
			<!-- <origin rpy="0 0 0" xyz="0 0 0.211163" /> -->
			<origin rpy="0 0 0" xyz="-0.0762 0 0.975963" />
			<mass value="2.75" />
			<inertia ixx="0.357177734375" ixy="0.0" iyy="0.373291015625" ixz="0.0" iyz="0.0" izz="0.01611328125" />
		</inertial>

		<visual name="keel_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/keel.obj" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="-0.0762 0 0.7648" />
		</visual>

		<collision name="keel_collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/keel.obj" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="-0.0762 0 0.7648" />
		</collision>
	</link>

	<link name="ballast">
		<inertial>
			<origin rpy="0 0 0" xyz="-0.179481 -0.000115 0.097428" />
			<!-- <origin rpy="0 0 0" xyz="0.045519 -0.000115 0.000028" /> -->
			<mass value="2.2" />
			<inertia ixx="0.0007085242765957447" ixy="-4.015390070921986e-08" iyy="0.013527595578652482" ixz="2.5175918439716314e-07" iyz="-1.4763794326241135e-08" izz="0.013527072944468085" />
		</inertial>

		<visual name="ballast_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/ballast.dae" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="-0.225 0 0.0974" />
		</visual>

		<collision name="ballast_collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/ballast_convex_hull.obj" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="-0.225 0 0.0974" />
		</collision>
	</link>

	<link name="mast">
		<inertial>
			<!-- <origin rpy="0 0 0" xyz="-0.000000 -0.000013 1.968355" /> -->
			<origin rpy="0 0 0" xyz="-0.000000 -0.000013 0.000355" />
			<mass value="1" />
			<inertia ixx="0.09072859154929577" ixy="0.0" iyy="0.09072929577464789" ixz="-1.5492957746478874e-07" iyz="-1.408450704225352e-07" izz="4.9999999999999996e-05" />
		</inertial>

		<visual name="mast_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/mast.dae" scale="1 1 1" />
			</geometry>
			<!-- <origin rpy="0 0 0" xyz="0 0 1.968" /> -->
			<origin rpy="0 0 0" xyz="0 0 0.5202" />
		</visual>

		<collision name="mast_collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/MainAxle.obj" scale="1 1 1" />
			</geometry>
			<!-- <origin rpy="0 0 0" xyz="0 0 1.968" /> -->
			<origin rpy="0 0 0" xyz="0 0 0.5202" />
		</collision>
	</link>

	<link name="sail">
		<inertial>
			<origin rpy="0 0 0" xyz="-0.022806 -0.000095 0.6726" />
			<!-- <origin rpy="0 0 0" xyz="-0.022806 -0.000095 0.000000" /> -->
			<mass value="1" />
			<inertia ixx="0.08199047329482112" ixy="0.0" iyy="0.08543630282760717" ixz="0.0" iyz="0.0" izz="0.00385122124252559" />
		</inertial>

		<collision name="sail_collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/sail_alone_convex_hull.obj" scale="1 1 1" />
			</geometry>
			<!-- <origin rpy="0 0 3.1415926535897932" xyz="0 0 2.1204" /> -->
			<origin rpy="0 0 3.1415926535897932" xyz="0 0 0.6726" />
		</collision>

		<visual name="sail_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/sail.dae" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 3.1415926535897932" xyz="0 0 0.6726" />
		</visual>
	</link>

	<link name="axle">
		<!-- <inertial>
            <origin rpy="0 0 0" xyz="-0.000013 0 0.000745" />
            <mass value="0.1" />
            <inertia ixx="0.0006398298250000001" ixy="1.1850000000000001e-09" iyy="0.00063982525" ixz="2.4567375000000005e-07" iyz="7.371e-08" izz="4.6929625e-07" />
        </inertial> -->

		<!-- <collision name="axle_collision">
            <geometry>
                <mesh filename="package://usv_sim/usv_sim/meshes/codfather/RudderAxle_convex_hull.obj" scale="1 1 1" />
            </geometry>
        </collision> -->

		<inertial>
			<origin rpy="0 0 0" xyz="-0.03 0 -0.035" />
			<mass value="0.5" />
			<inertia ixx="0.0015580802136752137" ixy="-1.7161266666666664e-05" iyy="0.0017239371367521368" ixz="0.00010010581196581196" iyz="1.0223873504273504e-05" izz="0.0001771534829059829" />
		</inertial>

		<visual name="axle_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/axle.dae" scale="1 1 1" />
			</geometry>
			<!-- <origin rpy="0 0 0" xyz="-0.894724 0 1.3970" /> -->
		</visual>

		<collision name="rudder_collision">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/rudder_convex_hull.obj" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="0 0 -0.0508" />
		</collision>

		<visual name="rudder_visual">
			<geometry>
				<mesh filename="package://usv_sim/meshes/codfather/rudder.dae" scale="1 1 1" />
			</geometry>
			<origin rpy="0 0 0" xyz="0 0 -0.0508" />
		</visual>
	</link>

	<!-- <link name="rudder">
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 -0.035" />
            <mass value="0.5" />
            <inertia ixx="0.0015580802136752137" ixy="-1.7161266666666664e-05" iyy="0.0017239371367521368" ixz="0.00010010581196581196" iyz="1.0223873504273504e-05" izz="0.0001771534829059829" />
        </inertial>

        <collision name="rudder_collision">
            <geometry>
                <mesh filename="package://usv_sim/usv_sim/meshes/codfather/rudder_convex_hull.obj" scale="1 1 1" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 -0.0508" />
        </collision>

        <visual name="rudder_visual">
            <geometry>
                <mesh filename="package://usv_sim/usv_sim/meshes/codfather/rudder.dae" scale="1 1 1" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 -0.0508" />
        </visual>
    </link> -->

	<joint name="sail_joint" type="revolute">
		<parent link="body" />
		<child link="mast" />
		<origin rpy="0 0 0" xyz="0 0 1.4478" />
		<dynamics damping="1.0" />
		<axis xyz="0 0 1" />
		<limit effort="100" velocity="70" lower="-3.1415926535897932" upper="3.1415926535897932" />
	</joint>

	<joint name="rudder_joint" type="revolute">
		<parent link="body" />
		<child link="axle" />
		<origin rpy="0 0 0" xyz="-0.894724 0 1.3970" />
		<dynamics damping="1.0" />
		<axis xyz="0 0 1" />
		<limit effort="100" lower="-1.5707963267948966" upper="1.5707963267948966" velocity="5" />
	</joint>

	<joint type="fixed" name="keel_connection">
		<origin rpy="0 0 0" xyz="0 0 0" />
		<child link="keel" />
		<parent link="body" />
	</joint>

	<joint type="fixed" name="ballast_connection">
		<origin rpy="0 0 0" xyz="0.0762 0 0.0254" />
		<child link="ballast" />
		<parent link="keel" />
	</joint>

	<joint type="fixed" name="sail_connection">
		<origin rpy="0 0 0" xyz="-0.0762 0 0" />
		<child link="sail" />
		<parent link="mast" />
	</joint>

	<!-- <joint type="fixed" name="rudder_connection">
        <origin rpy="0 0 0" xyz="0 0 0" />
        <child link="rudder" />
        <parent link="axle" />
    </joint> -->


	<!-- Plugin list -->
	<gazebo>

		<plugin name="usv_sail_plugin" filename="libfoil_dynamics_plugin.so">
			<link_type>sail</link_type>
			<a0>0</a0>
			<cla>3.0</cla>
			<cda>3.0</cda>
			<cma>-1.8</cma>
			<alpha_stall>0.785</alpha_stall>
			<cla_stall>-3.85</cla_stall>
			<cda_stall>-0.9233984055</cda_stall>
			<cma_stall>0</cma_stall>
			<cp>0 0 0</cp>
			<joint_name>sail_joint</joint_name>
			<area>1.44</area>
			<fluid_density>1.2041</fluid_density>
			<forward>-1 0 0</forward>
			<upward>0 1 0</upward>
			<link_name>sail</link_name>
			<fluidVelocity>${windType}</fluidVelocity>
		</plugin>


		<plugin name="usv_sail_plugin" filename="libfoil_dynamics_plugin.so">
			<link_type>keel</link_type>
			<a0>0</a0>
			<cla>10.0</cla>
			<cda>8.0</cda>
			<alpha_stall>0.785</alpha_stall>
			<cla_stall>-10.0</cla_stall>
			<cda_stall>-5.0</cda_stall>
			<cp>0 0 0</cp>
			<area>1.0</area>
			<fluid_density>1000</fluid_density>
			<forward>1 0 0</forward>
			<upward>0 1 0</upward>
			<link_name>keel</link_name>
			<fluidVelocity>${waterType}</fluidVelocity>
		</plugin>


		<plugin name="usv_sail_plugin" filename="libfoil_dynamics_plugin.so">
			<link_type>rudder</link_type>
			<a0>0</a0>
			<cla>0.8</cla>
			<cda>0.3</cda>
			<alpha_stall>0.785</alpha_stall>
			<cla_stall>-0.85</cla_stall>
			<cda_stall>-0.3233984055</cda_stall>

			<cp>0 0 0</cp>
			<area>1</area>
			<fluid_density>1000</fluid_density>
			<forward>1 0 0</forward>
			<upward>0 1 0</upward>
			<link_name>rudder</link_name>
			<fluidVelocity>${waterType}</fluidVelocity>
		</plugin>


		<plugin name="freefloating_gazebo_control" filename="libfreefloating_gazebo_control.so">
			<switchService>switch</switchService>
			<updateRate>100</updateRate>
			<link>body</link>
		</plugin>

	</gazebo>

</robot>